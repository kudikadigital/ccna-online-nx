generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Usuário Administrador
model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  email     String   @unique
  nome      String
  role      Role     @default(USER) // Permissões de acesso
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relacionamentos
  turmas Turma[] // Turmas que o admin criou
  
  @@map("admins")
}

// Instrutor/Formador
model Instrutor {
  id            Int       @id @default(autoincrement())
  nome          String
  email         String    @unique
  telefone      String?
  foto          String?
  biografia     String?
  especialidade String?
  certificacoes Json?     // Array de certificações em JSON
  experiencia   String?
  status        Status    @default(ATIVO)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relacionamentos
  turmas Turma[]
  
  @@map("instrutores")
}

// Aluno/Inscrito
model Aluno {
  id                Int       @id @default(autoincrement())
  nomeCompleto      String
  email             String    @unique
  whatsapp          String
  genero            Genero?
  dataNascimento    DateTime?
  nacionalidade     String?
  provincia         String?
  municipio         String?
  
  // Informações profissionais
  profissaoAtual    String?
  empresa           String?
  experienciaAnos   Int?
  areaInteresse     String?
  
  // Formação acadêmica
  nivelAcademico    NivelAcademico?
  curso             String?
  instituicao       String?
  
  // Motivação e dificuldades
  motivacao         String?   @db.Text
  dificuldades      String?   @db.Text
  expectativas      String?   @db.Text
  
  // Status financeiro
  tipoInscricao     TipoInscricao  @default(LEAD)
  statusPagamento   StatusPagamento @default(PENDENTE)
  valorPago         Float?    @default(0)
  dataPagamento     DateTime?
  metodoPagamento   String?
  referenciaPagamento String?
  
  // Informações do curso
  turmaId           Int?
  loteId            Int?
  
  // Controle
  status            Status    @default(ATIVO)
  observacoes       String?   @db.Text
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relacionamentos
  turma             Turma?    @relation(fields: [turmaId], references: [id])
  lote              Lote?     @relation(fields: [loteId], references: [id])
  
  @@map("alunos")
}

// Turma/Curso
model Turma {
  id               Int         @id @default(autoincrement())
  nome             String
  codigo           String      @unique  // Ex: CCNA-2024-01
  descricao        String?     @db.Text
  curso            String      // Ex: CCNA, CCNP, etc.
  modulo           Int?        // Módulo do curso
  dataInicio       DateTime
  dataFim          DateTime?
  horario          String?     // Ex: "Segunda e Quarta, 19h-21h"
  
  // Capacidade
  capacidadeMaxima Int         @default(30)
  vagasDisponiveis Int         @default(30)
  
  // Preços
  precoTotal       Float
  precoParcelado   Float?
  parcelas         Int?        @default(2)
  
  // Status
  status           StatusTurma @default(AGENDADA)
  visibilidade     Visibilidade @default(PUBLICA)
  
  // Controle
  adminId          Int
  instrutorId      Int?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  
  // Relacionamentos
  admin            Admin       @relation(fields: [adminId], references: [id])
  instrutor        Instrutor?  @relation(fields: [instrutorId], references: [id])
  alunos           Aluno[]
  lotes            Lote[]
  
  @@map("turmas")
}

// Lote de Preços/Promoções
model Lote {
  id               Int         @id @default(autoincrement())
  nome             String      // Ex: "Lote Promocional", "Primeiras Vagas"
  descricao        String?     @db.Text
  turmaId          Int
  preco            Float
  desconto         Float?      // Percentual de desconto
  vagas            Int         // Vagas disponíveis neste lote
  vagasUtilizadas  Int         @default(0)
  dataInicio       DateTime
  dataFim          DateTime
  status           Status      @default(ATIVO)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  
  // Relacionamentos
  turma            Turma       @relation(fields: [turmaId], references: [id])
  alunos           Aluno[]
  
  @@map("lotes")
}

// Pagamentos (Histórico)
model Pagamento {
  id                  Int         @id @default(autoincrement())
  alunoId             Int
  turmaId             Int
  valor               Float
  metodo              String      // "Transferência", "Dinheiro", "MBWay", etc.
  referencia          String?     // Referência da transação
  dataPagamento       DateTime
  status              StatusPagamento @default(PENDENTE)
  observacoes         String?     @db.Text
  comprovativoPath    String?     // Caminho para o comprovativo
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  
  // Relacionamentos
  aluno               Aluno       @relation(fields: [alunoId], references: [id])
  turma               Turma       @relation(fields: [turmaId], references: [id])
  
  @@map("pagamentos")
}

// ENUMS
enum Role {
  SUPER_ADMIN
  ADMIN
  EDITOR
  USER
}

enum Status {
  ATIVO
  INATIVO
  SUSPENSO
}

enum StatusTurma {
  RASCUNHO
  AGENDADA
  EM_ANDAMENTO
  CONCLUIDA
  CANCELADA
}

enum Visibilidade {
  PUBLICA
  PRIVADA
  RESTRITA
}

enum TipoInscricao {
  LEAD           // Apenas demonstrou interesse
  PRE_INSCRITO   // Preencheu formulário
  INSCRITO       // Confirmou inscrição
  MATRICULADO    // Efetuou pagamento
}

enum StatusPagamento {
  PENDENTE
  PARCIAL
  PAGO
  ATRASADO
  CANCELADO
}

enum Genero {
  MASCULINO
  FEMININO
  OUTRO
}

enum NivelAcademico {
  ENSINO_MEDIO
  TECNICO
  GRADUACAO
  POS_GRADUACAO
  MESTRADO
  DOUTORADO
}